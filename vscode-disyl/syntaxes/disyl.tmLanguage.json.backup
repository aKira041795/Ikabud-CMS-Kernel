{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "DiSyL",
  "scopeName": "text.html.disyl",
  "fileTypes": ["disyl"],
  "patterns": [
    { "include": "#disyl-comment" },
    { "include": "#disyl-control-structure" },
    { "include": "#disyl-component" },
    { "include": "#disyl-expression" },
    { "include": "text.html.basic" }
  ],
  "repository": {
    "disyl-comment": {
      "name": "comment.block.disyl",
      "begin": "\\{!--",
      "end": "--\\}",
      "patterns": [
        {
          "name": "comment.block.disyl",
          "match": "."
        }
      ]
    },
    "disyl-component": {
      "patterns": [
        {
          "name": "meta.tag.component.disyl",
          "begin": "(\\{)(ikb_[a-z_][a-z0-9_]*)",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "entity.name.tag.component.disyl" }
          },
          "end": "(/)?(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.self-closing.disyl" },
            "2": { "name": "punctuation.definition.tag.end.disyl" }
          },
          "patterns": [
            { "include": "#disyl-attributes" }
          ]
        },
        {
          "name": "meta.tag.component.closing.disyl",
          "match": "(\\{)(/)(ikb_[a-z_][a-z0-9_]*)(\\})",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "punctuation.definition.tag.closing.disyl" },
            "3": { "name": "entity.name.tag.component.disyl" },
            "4": { "name": "punctuation.definition.tag.end.disyl" }
          }
        }
      ]
    },
    "disyl-control-structure": {
      "patterns": [
        {
          "name": "meta.tag.control.if.disyl",
          "begin": "(\\{)(if)\\b",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "keyword.control.if.disyl" }
          },
          "end": "(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.end.disyl" }
          },
          "patterns": [
            { "include": "#disyl-attributes" }
          ]
        },
        {
          "name": "meta.tag.control.else.disyl",
          "match": "(\\{)(else)(\\})",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "keyword.control.else.disyl" },
            "3": { "name": "punctuation.definition.tag.end.disyl" }
          }
        },
        {
          "name": "meta.tag.control.if.closing.disyl",
          "match": "(\\{)(/)(if)(\\})",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "punctuation.definition.tag.closing.disyl" },
            "3": { "name": "keyword.control.if.disyl" },
            "4": { "name": "punctuation.definition.tag.end.disyl" }
          }
        },
        {
          "name": "meta.tag.control.for.disyl",
          "begin": "(\\{)(for)\\b",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "keyword.control.for.disyl" }
          },
          "end": "(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.end.disyl" }
          },
          "patterns": [
            { "include": "#disyl-attributes" }
          ]
        },
        {
          "name": "meta.tag.control.for.closing.disyl",
          "match": "(\\{)(/)(for)(\\})",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "punctuation.definition.tag.closing.disyl" },
            "3": { "name": "keyword.control.for.disyl" },
            "4": { "name": "punctuation.definition.tag.end.disyl" }
          }
        },
        {
          "name": "meta.tag.control.include.disyl",
          "begin": "(\\{)(include)\\b",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.disyl" },
            "2": { "name": "keyword.control.include.disyl" }
          },
          "end": "(/)?(\\})",
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.self-closing.disyl" },
            "2": { "name": "punctuation.definition.tag.end.disyl" }
          },
          "patterns": [
            { "include": "#disyl-attributes" }
          ]
        }
      ]
    },
    "disyl-expression": {
      "name": "meta.expression.disyl",
      "begin": "\\{(?![!-/]|ikb_|if\\b|for\\b|else\\b|include\\b)",
      "end": "\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.expression.begin.disyl" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.expression.end.disyl" }
      },
      "patterns": [
        { "include": "#disyl-filter-pipeline" },
        { "include": "#disyl-expression-content" }
      ]
    },
    "disyl-expression-content": {
      "patterns": [
        {
          "name": "variable.other.property.disyl",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*(\\.[a-zA-Z_][a-zA-Z0-9_]*)+\\b"
        },
        {
          "name": "variable.other.disyl",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
        },
        {
          "name": "constant.numeric.disyl",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        },
        {
          "name": "constant.language.boolean.disyl",
          "match": "\\b(true|false)\\b"
        },
        {
          "name": "string.quoted.double.disyl",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.disyl",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.single.disyl",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.disyl",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "disyl-filter-pipeline": {
      "patterns": [
        {
          "name": "meta.filter.disyl",
          "match": "(\\|)\\s*([a-z_][a-z0-9_]*)",
          "captures": {
            "1": { "name": "keyword.operator.pipe.disyl" },
            "2": { "name": "entity.name.function.filter.disyl" }
          }
        },
        {
          "name": "meta.filter.arguments.disyl",
          "begin": "(:)",
          "beginCaptures": {
            "1": { "name": "punctuation.separator.colon.disyl" }
          },
          "end": "(?=[\\|\\}])",
          "patterns": [
            { "include": "#disyl-filter-argument" }
          ]
        }
      ]
    },
    "disyl-filter-argument": {
      "patterns": [
        {
          "name": "meta.filter.argument.named.disyl",
          "match": "([a-z_][a-z0-9_]*)\\s*(=)\\s*",
          "captures": {
            "1": { "name": "variable.parameter.disyl" },
            "2": { "name": "keyword.operator.assignment.disyl" }
          }
        },
        {
          "name": "punctuation.separator.comma.disyl",
          "match": ","
        },
        {
          "name": "string.quoted.double.disyl",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.disyl",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "constant.numeric.disyl",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        },
        {
          "name": "constant.language.boolean.disyl",
          "match": "\\b(true|false)\\b"
        }
      ]
    },
    "disyl-attributes": {
      "patterns": [
        {
          "name": "meta.attribute.disyl",
          "begin": "\\b([a-z][a-z0-9_-]*)\\s*(=)\\s*",
          "beginCaptures": {
            "1": { "name": "entity.other.attribute-name.disyl" },
            "2": { "name": "punctuation.separator.key-value.disyl" }
          },
          "end": "(?=[\\s/>}])",
          "patterns": [
            { "include": "#disyl-attribute-value" }
          ]
        }
      ]
    },
    "disyl-attribute-value": {
      "patterns": [
        {
          "name": "string.quoted.double.disyl",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.disyl",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.single.disyl",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.disyl",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "meta.embedded.expression.disyl",
          "begin": "\\{",
          "end": "\\}",
          "patterns": [
            { "include": "#disyl-expression-content" },
            { "include": "#disyl-filter-pipeline" }
          ]
        },
        {
          "name": "constant.language.boolean.disyl",
          "match": "\\b(true|false)\\b"
        },
        {
          "name": "constant.numeric.disyl",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        }
      ]
    },
    "html-content": {
      "patterns": [
        {
          "name": "meta.tag.any.html",
          "begin": "(<)([a-zA-Z][a-zA-Z0-9]*)",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.html" },
            "2": { "name": "entity.name.tag.html" }
          },
          "end": "(/)?(>)",
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.self-closing.html" },
            "2": { "name": "punctuation.definition.tag.end.html" }
          },
          "patterns": [
            {
              "name": "entity.other.attribute-name.html",
              "match": "\\b[a-z][a-z0-9_-]*\\b"
            },
            {
              "name": "string.quoted.double.html",
              "begin": "\"",
              "end": "\""
            },
            {
              "name": "string.quoted.single.html",
              "begin": "'",
              "end": "'"
            }
          ]
        },
        {
          "name": "meta.tag.any.html",
          "match": "(</)([a-zA-Z][a-zA-Z0-9]*)(>)",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.html" },
            "2": { "name": "entity.name.tag.html" },
            "3": { "name": "punctuation.definition.tag.end.html" }
          }
        }
      ]
    }
  }
}
